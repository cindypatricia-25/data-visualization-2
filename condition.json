{
    "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
    "description": "A mosaic chart showing crash count distribution by vehicle type and condition.",
    "width": 600,
    "height": 400,
    "data": {
      "values": [
        {"Type": "Pedestrian", "CrashCount": 7020, "Condition": "Hospitalized"},
        {"Type": "Pedal Cycle", "CrashCount": 29587, "Condition": "Hospitalized"},
        {"Type": "Motorcycle", "CrashCount": 29729, "Condition": "Hospitalized"},
        {"Type": "Car", "CrashCount": 38094, "Condition": "Hospitalized"},
        {"Type": "Heavy transport vehicle", "CrashCount": 2968, "Condition": "Hospitalized"},
        {"Type": "Other land transport", "CrashCount": 2866, "Condition": "Hospitalized"},
        {"Type": "Other", "CrashCount": 3417, "Condition": "Hospitalized"},
        {"Type": "Pedestrian", "CrashCount": 344, "Condition": "Death"},
        {"Type": "Pedal Cycle", "CrashCount": 72, "Condition": "Death"},
        {"Type": "Motorcycle", "CrashCount": 496, "Condition": "Death"},
        {"Type": "Car", "CrashCount": 1472, "Condition": "Death"},
        {"Type": "Heavy transport vehicle", "CrashCount": 84, "Condition": "Death"},
        {"Type": "Other land transport", "CrashCount": 152, "Condition": "Death"},
        {"Type": "Other", "CrashCount": 168, "Condition": "Death"}
      ]
    },
    "transform": [
      {
        "aggregate": [{"op": "sum", "field": "CrashCount", "as": "TotalCrashCount"}],
        "groupby": ["Type"]
      },
      {
        "joinaggregate": [{"op": "sum", "field": "TotalCrashCount", "as": "OverallTotal"}]
      },
      {
        "calculate": "datum.TotalCrashCount / datum.OverallTotal",
        "as": "TypeProportion"
      },
      {
        "calculate": "datum.CrashCount / datum.TotalCrashCount",
        "as": "ConditionProportion"
      }
    ],
    "encoding": {
      "x": {
        "field": "TypeProportion",
        "type": "quantitative",
        "title": "Vehicle Type Proportion",
        "axis": {"format": ".0%"}
      },
      "y": {
        "field": "ConditionProportion",
        "type": "quantitative",
        "title": "Crash Condition Proportion",
        "axis": {"format": ".0%"}
      },
      "color": {
        "field": "Condition",
        "type": "nominal",
        "title": "Crash Condition",
        "scale": {"scheme": "category20b"}
      },
      "tooltip": [
        {"field": "Type", "title": "Vehicle Type"},
        {"field": "Condition", "title": "Crash Condition"},
        {"field": "CrashCount", "title": "Crash Count"},
        {"field": "TypeProportion", "title": "Vehicle Proportion", "format": ".2%"},
        {"field": "ConditionProportion", "title": "Condition Proportion", "format": ".2%"}
      ]
    },
    "mark": "bar"
  }
  